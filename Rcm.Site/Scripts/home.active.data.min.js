(function(){var b=null,e=null,g={tooltip:{trigger:"axis"},grid:{top:15,left:5,right:15,bottom:0,containLabel:true},xAxis:[{type:"category",boundaryGap:false,splitLine:{show:false},data:[]}],yAxis:[{type:"value"}],series:[{name:"\u5b9e\u65f6\u6d4b\u503c",type:"line",smooth:true,symbol:"none",sampling:"average",itemStyle:{normal:{color:"#0892cd"}},areaStyle:{normal:{}},data:[]}]};Ext.define("PointModel",{extend:"Ext.data.Model",fields:[{name:"id",type:"int"},{name:"name",type:"string"},{name:"type",type:"int"},{name:"typeDisplay",type:"string"},{name:"value",type:"float"},{name:"valueDisplay",type:"string"},{name:"status",type:"int"},{name:"statusDisplay",type:"string"},{name:"timestamp",type:"string"},{name:"shortTime",type:"string"}],idProperty:"id"});var i=Ext.create("Ext.data.Store",{autoLoad:false,pageSize:20,model:"PointModel",groupField:"typeDisplay",groupDir:"undefined",sortOnLoad:false,proxy:{type:"ajax",url:"/Home/RequestPoints",reader:{type:"json",successProperty:"success",messageProperty:"message",totalProperty:"total",root:"data"},extraParams:{node:"root",types:[$$Rcms.Organization.Dic,$$Rcms.Organization.Aic,$$Rcms.Organization.Aoc,$$Rcms.Organization.Doc]},simpleSortMode:true},listeners:{load:function(o,k,p){if(p){if(k.length>0){var n=Ext.getCmp("active-grid");if(n.getSelectionModel().hasSelection()){var m=n.getSelectionModel().getSelection()[0].getId();var j=o.getById(m);if(j!=null){var l=e.getOption();if(g.xAxis[0].data.length>90){g.xAxis[0].data.shift()}if(g.series[0].data.length>90){g.series[0].data.shift()}g.xAxis[0].data.push(j.get("shortTime"));g.series[0].data.push(j.get("value"));e.setOption(g)}}}$$Rcms.Tasks.actPointTask.fireOnStart=false;$$Rcms.Tasks.actPointTask.restart()}}}});var a=function(j,l,p){var k=j.getRootNode(),o="id",n="/",m=l.join(n);m=n+k.get(o)+n+m;j.selectPath(m,o,n,p||Ext.emptyFn)};var f=Ext.create("Ext.window.Window",{title:"\u4fe1\u53f7\u9065\u63a7\u53c2\u6570",height:250,width:400,glyph:58907,modal:true,border:false,hidden:true,closeAction:"hide",items:[{xtype:"form",itemId:"controlForm",border:false,padding:10,items:[{itemId:"point",xtype:"hiddenfield",name:"point"},{itemId:"type",xtype:"hiddenfield",name:"type"},{itemId:"controlradio",xtype:"radiogroup",columns:1,vertical:true,items:[{boxLabel:"\u5e38\u5f00\u63a7\u5236(0)",name:"ctrl",inputValue:0,checked:true},{boxLabel:"\u5e38\u95ed\u63a7\u5236(1)",name:"ctrl",inputValue:1},{boxLabel:"\u8109\u51b2\u63a7\u5236(2)",name:"ctrl",inputValue:2}]}]}],buttons:[{id:"controlResult",xtype:"iconlabel",text:""},{xtype:"tbfill"},{xtype:"button",text:"\u9065\u63a7",handler:function(k,n){var l=f.getComponent("controlForm"),m=l.getForm(),j=Ext.getCmp("controlResult");j.setTextWithIcon("","");if(m.isValid()){j.setTextWithIcon("\u6b63\u5728\u5904\u7406\uff0c\u8bf7\u7a0d\u540e...","x-icon-loading");m.submit({submitEmptyText:false,clientValidation:true,preventWindow:true,url:"/Home/ControlPoint",success:function(o,p){j.setTextWithIcon(p.result.message,"x-icon-accept")},failure:function(p,q){var o="undefined error.";if(!Ext.isEmpty(q.result)&&!Ext.isEmpty(q.result.message)){o=q.result.message}j.setTextWithIcon(o,"x-icon-error")}})}else{j.setTextWithIcon("\u8868\u5355\u586b\u5199\u9519\u8bef","x-icon-error")}}},{xtype:"button",text:"\u5173\u95ed",handler:function(j,m){var k=f.getComponent("controlForm"),l=k.getForm();l.reset();f.close()}}]});var d=Ext.create("Ext.window.Window",{title:"\u4fe1\u53f7\u9065\u8c03\u53c2\u6570",height:250,width:400,glyph:58899,modal:true,border:false,hidden:true,closeAction:"hide",items:[{xtype:"form",itemId:"adjustForm",border:false,padding:10,items:[{itemId:"point",xtype:"hiddenfield",name:"point"},{itemId:"type",xtype:"hiddenfield",name:"type"},{itemId:"adjust",xtype:"numberfield",name:"adjust",fieldLabel:"\u6a21\u62df\u91cf\u8f93\u51fa\u503c",value:0,width:280,allowOnlyWhitespace:false}]}],buttons:[{id:"adjustResult",xtype:"iconlabel",text:""},{xtype:"tbfill"},{xtype:"button",text:"\u9065\u8c03",handler:function(k,n){var l=d.getComponent("adjustForm"),m=l.getForm(),j=Ext.getCmp("adjustResult");j.setTextWithIcon("","");if(m.isValid()){j.setTextWithIcon("\u6b63\u5728\u5904\u7406\uff0c\u8bf7\u7a0d\u540e...","x-icon-loading");m.submit({submitEmptyText:false,clientValidation:true,preventWindow:true,url:"/Home/AdjustPoint",success:function(o,p){j.setTextWithIcon(p.result.message,"x-icon-accept")},failure:function(p,q){var o="undefined error.";if(!Ext.isEmpty(q.result)&&!Ext.isEmpty(q.result.message)){o=q.result.message}j.setTextWithIcon(o,"x-icon-error")}})}else{j.setTextWithIcon("\u8868\u5355\u586b\u5199\u9519\u8bef","x-icon-error")}}},{xtype:"button",text:"\u5173\u95ed",handler:function(j,m){var k=d.getComponent("adjustForm"),l=k.getForm();l.reset();d.close()}}]});var c=Ext.create("Ext.tree.Panel",{id:"system-organization",region:"west",title:"\u7cfb\u7edf\u8bbe\u5907\u5217\u8868",glyph:58905,width:220,split:true,collapsible:true,collapsed:false,autoScroll:true,useArrows:false,rootVisible:true,root:{id:"root",text:"\u76d1\u63a7\u4e2d\u5fc3",expanded:true,icon:"/Content/themes/icons/home.png"},viewConfig:{loadMask:true},store:Ext.create("Ext.data.TreeStore",{autoLoad:false,nodeParam:"node",proxy:{type:"ajax",url:"/Home/GetOrganization",reader:{type:"json",successProperty:"success",messageProperty:"message",totalProperty:"total",root:"data"}}}),listeners:{select:function(l,j,k){b=j;i.proxy.extraParams.node=j.getId();i.loadPage(1)}},tbar:[{id:"search-field",xtype:"textfield",emptyText:"\u8bf7\u8f93\u5165\u7b5b\u9009\u6761\u4ef6...",flex:1,listeners:{change:function(l,m,j,k){delete l._filterData;delete l._filterIndex}}},{id:"search-button",xtype:"button",glyph:58893,handler:function(){var j=Ext.getCmp("system-organization"),l=Ext.getCmp("search-field"),n=l.getRawValue();if(Ext.isEmpty(n,false)){return}if(n.length<2){return}if(l._filterData!=null&&l._filterIndex!=null){var k=l._filterIndex+1;var m=l._filterData;if(k>=m.length){k=0;Ext.Msg.show({title:"\u7cfb\u7edf\u63d0\u793a",msg:"\u641c\u7d22\u5b8c\u6bd5",buttons:Ext.Msg.OK,icon:Ext.Msg.INFO})}a(j,m[k]);l._filterIndex=k}else{Ext.Ajax.request({url:"/Home/SearchOrganization",params:{text:n},mask:new Ext.LoadMask({target:j,msg:"\u6b63\u5728\u5904\u7406\uff0c\u8bf7\u7a0d\u540e..."}),success:function(p,q){var r=Ext.decode(p.responseText,true);if(r.success){var o=r.data.length;if(o>0){a(j,r.data[0]);l._filterData=r.data;l._filterIndex=0}else{Ext.Msg.show({title:"\u7cfb\u7edf\u63d0\u793a",msg:Ext.String.format("\u672a\u627e\u5230\u6307\u5b9a\u5185\u5bb9:<br/>{0}",n),buttons:Ext.Msg.OK,icon:Ext.Msg.INFO})}}else{Ext.Msg.show({title:"\u7cfb\u7edf\u9519\u8bef",msg:r.message,buttons:Ext.Msg.OK,icon:Ext.Msg.ERROR})}}})}}}]});var h=Ext.create("Ext.panel.Panel",{id:"dashboard",region:"center",border:false,bodyCls:"x-border-body-panel",layout:{type:"vbox",align:"stretch"},items:[{id:"active-line",xtype:"panel",glyph:58908,title:"\u4fe1\u53f7\u5b9e\u65f6\u56fe\u8868",collapsible:true,collapseFirst:false,height:180},{id:"active-grid",xtype:"grid",collapsible:false,collapseFirst:false,layout:"fit",margin:"5 0 0 0",flex:1,header:{glyph:58898,title:"\u4fe1\u53f7\u5b9e\u65f6\u6d4b\u503c",items:[{xtype:"checkboxgroup",width:240,items:[{xtype:"checkboxfield",boxLabel:"\u9065\u4fe1",inputValue:$$Rcms.Organization.Dic,checked:true,boxLabelCls:"x-label-header x-form-cb-label"},{xtype:"checkboxfield",boxLabel:"\u9065\u6d4b",inputValue:$$Rcms.Organization.Aic,checked:true,boxLabelCls:"x-label-header x-form-cb-label"},{xtype:"checkboxfield",boxLabel:"\u9065\u8c03",inputValue:$$Rcms.Organization.Aoc,checked:true,boxLabelCls:"x-label-header x-form-cb-label"},{xtype:"checkboxfield",boxLabel:"\u9065\u63a7",inputValue:$$Rcms.Organization.Doc,checked:true,boxLabelCls:"x-label-header x-form-cb-label"},],listeners:{change:function(l,m,j){var k=[];Ext.Object.each(m,function(n,p,o){k.push(p)});i.proxy.extraParams.types=k;i.loadPage(1)}}}]},tools:[{type:"refresh",tooltip:"\u5237\u65b0",handler:function(l,k,j){i.loadPage(1)}}],store:i,viewConfig:{loadMask:false,preserveScrollOnRefresh:true,stripeRows:true,trackOver:true,emptyText:'<h1 style="margin:20px">\u6ca1\u6709\u6570\u636e\u8bb0\u5f55</h1>',getRowClass:function(j,m,l,k){return $$Rcms.GetPointStatusCls(j.get("status"))}},features:[{ftype:"grouping",groupHeaderTpl:"{columnName}: {name} ({rows.length}\u6761)",hideGroupedHeader:false,startCollapsed:false}],columns:[{text:"\u4fe1\u53f7\u72b6\u6001",dataIndex:"statusDisplay",tdCls:"x-status-cell",align:"center"},{text:"\u4fe1\u53f7\u7c7b\u578b",dataIndex:"typeDisplay",align:"center"},{text:"\u4fe1\u53f7\u540d\u79f0",dataIndex:"name",width:150},{text:"\u4fe1\u53f7\u6d4b\u503c",dataIndex:"value"},{text:"\u5355\u4f4d/\u63cf\u8ff0",dataIndex:"valueDisplay",align:"center"},{text:"\u503c\u53d8\u65f6\u95f4",dataIndex:"timestamp",width:150,align:"center"},{xtype:"actioncolumn",width:80,align:"center",menuDisabled:true,menuText:"\u64cd\u4f5c",text:"\u64cd\u4f5c",items:[{tooltip:"\u9065\u63a7",getClass:function(k,m,n,o,l,j){return(n.get("type")===$$Rcms.Organization.Doc)?"x-cell-icon x-icon-remote-control":"x-cell-icon x-icon-hidden"},handler:function(o,n,q,r,j,l){o.getSelectionModel().select(l);var k=f.getComponent("controlForm"),p=k.getComponent("point"),m=k.getComponent("type"),s=Ext.getCmp("controlResult");p.setValue(l.getId());m.setValue(l.get("type"));s.setTextWithIcon("","");f.show()}},{tooltip:"\u9065\u8c03",getClass:function(k,m,n,o,l,j){return(n.get("type")===$$Rcms.Organization.Aoc)?"x-cell-icon x-icon-remote-setting":"x-cell-icon x-icon-hidden"},handler:function(o,n,q,r,j,l){o.getSelectionModel().select(l);var k=d.getComponent("adjustForm"),p=k.getComponent("point"),m=k.getComponent("type"),s=Ext.getCmp("adjustResult");p.setValue(l.getId());m.setValue(l.get("type"));s.setTextWithIcon("","");d.show()}}]}],listeners:{selectionchange:function(j,k){if(g.xAxis[0].data.length>0){g.xAxis[0].data=[]}if(g.series[0].data.length>0){g.series[0].data=[]}g.tooltip.formatter=null;if(k.length>0){g.tooltip.formatter="X: {b}<br/>Y: {c} "+k[0].get("valueDisplay");g.xAxis[0].data.push(k[0].get("shortTime"));g.series[0].data.push(k[0].get("value"))}e.setOption(g)}}}]});Ext.onReady(function(){$$Rcms.Tasks.actPointTask.run=function(){i.loadPage(1)};$$Rcms.Tasks.actOrderTask.run=function(){Ext.Ajax.request({url:"/Home/SetOrders",params:{node:(b!=null?b.getId():"-1")},success:function(k,l){$$Rcms.Tasks.actOrderTask.fireOnStart=false;$$Rcms.Tasks.actOrderTask.restart()}})};$$Rcms.Tasks.actPointTask.start();$$Rcms.Tasks.actOrderTask.start();var j=Ext.getCmp("center-content-panel-fw");if(!Ext.isEmpty(j)){j.add([c,h])}e=echarts.init(Ext.getCmp("active-line").body.dom,"shine");e.setOption(g)})})();
