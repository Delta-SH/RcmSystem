(function(){var d=null;Ext.define("AlarmModel",{extend:"Ext.data.Model",fields:[{name:"index",type:"int"},{name:"id",type:"int"},{name:"level",type:"int"},{name:"levelDisplay",type:"string"},{name:"time",type:"string"},{name:"area",type:"string"},{name:"station",type:"string"},{name:"device",type:"string"},{name:"point",type:"string"},{name:"comment",type:"string"},{name:"value",type:"float"},{name:"confirmer",type:"string"},{name:"confirmedTime",type:"string"},{name:"interval",type:"string"}],idProperty:"index"});var i=Ext.create("Ext.data.Store",{autoLoad:false,pageSize:20,model:"AlarmModel",proxy:{type:"ajax",url:"/Home/RequestActAlarms",reader:{type:"json",successProperty:"success",messageProperty:"message",totalProperty:"total",root:"data"},extraParams:{node:"root",stationtypes:[],devicetypes:[],alarmlevels:[]},simpleSortMode:true},listeners:{load:function(k,j,l){if(l){$$Rcms.Tasks.actAlarmTask.fireOnStart=false;$$Rcms.Tasks.actAlarmTask.restart()}}}});var g=$$Rcms.clonePagingToolbar(i);var a=function(j,l,p){var k=j.getRootNode(),o="id",n="/",m=l.join(n);m=n+k.get(o)+n+m;j.selectPath(m,o,n,p||Ext.emptyFn)};var f=function(l,j){var k=j.store;k.proxy.extraParams.node=l.getId();k.loadPage(1)};var c=function(j){var k=j.store;k.proxy.extraParams.stationtypes=Ext.getCmp("station-type-multicombo").getSelectedValues();k.proxy.extraParams.devicetypes=Ext.getCmp("device-type-multicombo").getSelectedValues();k.proxy.extraParams.alarmlevels=Ext.getCmp("alarm-level-multicombo").getSelectedValues();k.loadPage(1)};var b=function(j){$$Rcms.download({url:"/Home/DownloadActAlarms",params:j.proxy.extraParams})};var e=Ext.create("Ext.tree.Panel",{id:"system-organization",region:"west",title:"\u7cfb\u7edf\u8bbe\u5907\u5217\u8868",glyph:58905,width:220,split:true,collapsible:true,collapsed:false,autoScroll:true,useArrows:false,rootVisible:true,root:{id:"root",text:"\u76d1\u63a7\u4e2d\u5fc3",expanded:true,icon:"/Content/themes/icons/home.png"},viewConfig:{loadMask:true},store:Ext.create("Ext.data.TreeStore",{autoLoad:false,nodeParam:"node",proxy:{type:"ajax",url:"/Home/GetOrganization",reader:{type:"json",successProperty:"success",messageProperty:"message",totalProperty:"total",root:"data"}}}),listeners:{select:function(l,j,k){d=j;f(j,g)}},tbar:[{id:"search-field",xtype:"textfield",emptyText:"\u8bf7\u8f93\u5165\u7b5b\u9009\u6761\u4ef6...",flex:1,listeners:{change:function(l,m,j,k){delete l._filterData;delete l._filterIndex}}},{id:"search-button",xtype:"button",glyph:58893,handler:function(){var j=Ext.getCmp("system-organization"),l=Ext.getCmp("search-field"),n=l.getRawValue();if(Ext.isEmpty(n,false)){return}if(n.length<2){return}if(l._filterData!=null&&l._filterIndex!=null){var k=l._filterIndex+1;var m=l._filterData;if(k>=m.length){k=0;Ext.Msg.show({title:"\u7cfb\u7edf\u63d0\u793a",msg:"\u641c\u7d22\u5b8c\u6bd5",buttons:Ext.Msg.OK,icon:Ext.Msg.INFO})}a(j,m[k]);l._filterIndex=k}else{Ext.Ajax.request({url:"/Home/SearchOrganization",params:{text:n},mask:new Ext.LoadMask({target:j,msg:"\u6b63\u5728\u5904\u7406\uff0c\u8bf7\u7a0d\u540e..."}),success:function(p,q){var r=Ext.decode(p.responseText,true);if(r.success){var o=r.data.length;if(o>0){a(j,r.data[0]);l._filterData=r.data;l._filterIndex=0}else{Ext.Msg.show({title:"\u7cfb\u7edf\u63d0\u793a",msg:Ext.String.format("\u672a\u627e\u5230\u6307\u5b9a\u5185\u5bb9:<br/>{0}",n),buttons:Ext.Msg.OK,icon:Ext.Msg.INFO})}}else{Ext.Msg.show({title:"\u7cfb\u7edf\u9519\u8bef",msg:r.message,buttons:Ext.Msg.OK,icon:Ext.Msg.ERROR})}}})}}}]});var h=Ext.create("Ext.grid.Panel",{id:"active-grid",glyph:58898,title:"\u5b9e\u65f6\u544a\u8b66\u4fe1\u606f",region:"center",store:i,dockedItems:[{xtype:"panel",glyph:58906,dock:"top",items:[{xtype:"toolbar",border:false,items:[{id:"station-type-multicombo",xtype:"StationTypeMultiCombo",emptyText:"\u9ed8\u8ba4\u5168\u90e8"},{id:"device-type-multicombo",xtype:"DeviceTypeMultiCombo",emptyText:"\u9ed8\u8ba4\u5168\u90e8"},{id:"alarm-level-multicombo",xtype:"AlarmLevelMultiCombo",emptyText:"\u9ed8\u8ba4\u5168\u90e8"},{xtype:"splitbutton",glyph:58893,text:"\u786e\u5b9a",handler:function(k,j){c(g)},menu:[{text:"\u6570\u636e\u5bfc\u51fa",glyph:58889,handler:function(k,j){b(i)}}]}]}]}],tools:[{type:"refresh",tooltip:"\u5237\u65b0",handler:function(l,k,j){g.doRefresh()}},{type:"print",tooltip:"\u6570\u636e\u5bfc\u51fa",handler:function(l,k,j){b(i)}}],viewConfig:{loadMask:false,preserveScrollOnRefresh:true,stripeRows:true,trackOver:true,emptyText:'<h1 style="margin:20px">\u6ca1\u6709\u6570\u636e\u8bb0\u5f55</h1>',getRowClass:function(j,m,l,k){return $$Rcms.GetAlmLevelCls(j.get("level"))}},columns:[{text:"\u5e8f\u53f7",dataIndex:"index",width:60},{text:"\u544a\u8b66\u7ea7\u522b",dataIndex:"levelDisplay",align:"center",tdCls:"x-level-cell"},{text:"\u544a\u8b66\u65f6\u95f4",dataIndex:"time",align:"center",width:150},{text:"\u6240\u5c5e\u533a\u57df",dataIndex:"area"},{text:"\u6240\u5c5e\u7ad9\u70b9",dataIndex:"station"},{text:"\u8bbe\u5907\u540d\u79f0",dataIndex:"device"},{text:"\u4fe1\u53f7\u540d\u79f0",dataIndex:"point"},{text:"\u544a\u8b66\u63cf\u8ff0",dataIndex:"comment"},{text:"\u89e6\u53d1\u503c",dataIndex:"value"},{text:"\u786e\u8ba4\u4eba\u5458",dataIndex:"confirmer"},{text:"\u786e\u8ba4\u65f6\u95f4",dataIndex:"confirmedTime",width:150},{text:"\u544a\u8b66\u65f6\u957f",dataIndex:"interval",width:150}],bbar:g});Ext.onReady(function(){$$Rcms.Tasks.actAlarmTask.run=function(){g.doRefresh()};$$Rcms.Tasks.actAlarmTask.start();var j=Ext.getCmp("center-content-panel-fw");if(!Ext.isEmpty(j)){j.add([e,h])}})})();
